{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VTMS</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css">
    <link rel="stylesheet" href="{% static 'css2/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'css2/OverlayScrollbars.min.css' %}">
    <link rel="stylesheet" href="{% static 'css2/adminlte.min.css' %}">
    <link rel="stylesheet" href="{% static 'css2/style.css' %}">


    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
	<!--<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}"> -->
	<link rel="stylesheet" href="{% static 'css/jquery-ui.css' %}">
	<link rel="stylesheet" href="{% static 'css/leaflet.css' %}"/>
	<!--<link rel="stylesheet" href="{% static 'css/style.css' %}"/> -->
	<!--<link rel="stylesheet" href="{% static 'css/bootstrap-datetimepicker.min.css' %}"/>-->
	<!--<link rel="stylesheet" href="{% static 'css/theme_default.css' %}"/> -->
	<link rel="stylesheet" href="{% static 'css/MarkerCluster.css' %}"/>
	<link rel="stylesheet" href="{% static 'css/MarkerCluster.Default.css' %}"/>
 <link rel="stylesheet" href="{% static 'css2/daterangepicker.css' %}"/>
 <link rel="stylesheet" href="{% static 'css2/datepicker.css' %}"/>
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">


 <script src="{% static 'js/jquery.min.js' %}"></script>
  <!--<script src="{% static 'js/moment.js' %}"></script> -->
  <script src="{% static 'js/popper.min.js' %}"></script>
  <script src="{% static 'js/bootstrap.min.js' %}"></script>
  <script src="{% static 'js/jquery-ui.min.js' %}"></script>
  <script src="{% static 'js/jquery.tablesorter.min.js' %}"></script>
  <script src="{% static 'js/jquery.table2excel.js' %}"></script>
  <script src="{% static 'js/leaflet.js' %}"></script>
  <!--<script src="{% static 'js/bootstrap-datetimepicker.min.js' %}"></script> -->
  <script src="{% static 'js/tableHTMLExport.js' %}"></script>
  <script src="{% static 'js/jspdf.js' %}"></script>
  <script src="{% static 'js/jspdf.plugin.autotable.min.js' %}"></script>
  <!--<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
  integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
  crossorigin=""></script>
  <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>-->
  <script src="{% static 'js/leaflet_routing_machine.js' %}"></script>
  <script src="{% static 'js/leaflet.markercluster.js' %}"></script>
  <script src="{% static 'js/MovingMarker.js' %}"></script>
</head>

<body class="hold-transition sidebar-mini layout-navbar-fixed">
    <!-- Site wrapper -->
    <div class="wrapper">
        
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
            </ul>
            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <!-- Navbar Search -->
                <div class="contact-bg">
                    <li class="nav-item">
                        <h5 class="mb-0">Help Desk</h5>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-widget="" href="#" role="button">
                            <i class="fas fa-phone-alt"></i> +91 22 2925 0372 / +91 9769784764
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-widget="" href="mailto:vtms-support@qdnet.com" role="button">
                            <i class="fas fa-envelope"></i> vtms-support@qdnet.com
                        </a>
                    </li>
                </div>
             <!--    <li class="nav-item">
                    <a class="nav-link" data-widget="navbar-search" href="#" role="button">
                        <i class="fas fa-search"></i>
                    </a>
                   <div class="navbar-search-block">
                        <form class="form-inline">
                            <div class="input-group input-group-sm">
                                <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
                                <div class="input-group-append">
                                    <button class="btn btn-navbar" type="submit"><i class="fas fa-search"></i>
                                </button>
                                    <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                  <i class="fas fa-times"></i>
                </button>
                                </div>
                            </div>
                        </form>
                    </div> 
                </li>-->
                <li class="nav-item">
                    <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="" href="{% url 'logout' %}">
                      Welcome {{ user.username }}  | <b class="logout">Logout</b>
                      
                    </a>
                </li>

            </ul>
        </nav>

        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <!-- Brand Logo -->
            <a href="#" class="brand-link elevation-4">
                <img src="{% static 'images2/mcgm-logo.png' %}" alt="VTMS" class="brand-image img-circle elevation-3" width="150">
                <span class="brand-text font-weight-light">VTMS</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="{% static 'images2/user.jpg' %}" class="img-circle elevation-2" alt="User Image">
                    </div>
                    <div class="info">
                        <a href="#" class="d-block">{{ user.username }}</a>
                    </div>
                </div>

                <!-- SidebarSearch Form -->
            <!--    <div class="form-inline">
                    <div class="input-group" data-widget="sidebar-search">
                        <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search"> 
                        <div class="input-group-append">
                            <button class="btn btn-sidebar">
              <i class="fas fa-search fa-fw"></i>
            </button>
                        </div>
                    </div>
                </div> -->

                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <i class="nav-icon"><img src="{% static 'images2/dashboard.png' %}" alt="Dashboard" width="25"></i>
                                <p>Dashboard
                                    <i class="right fas fa-angle-left"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="{% url 'latest_vehicle_status' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Status</p>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="{% url 'quick_view' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>View</p>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <i class="nav-icon"><img src="{% static 'images2/report.png' %}" alt="Report" width="25"></i>
                                <p>
                                    Report
                                    <i class="fas fa-angle-left right"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="{% url 'vehicle_route_report' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Vehicle Route Report</p>
                                    </a>
                                </li>

                            </ul>
                        </li>


                        {% if user.is_authenticated and user.is_superuser %}
                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <i class="nav-icon"><img src="{% static 'images2/report.png' %}" alt="Report" width="25"></i>
                                <p>
                                    Admin
                                    <i class="fas fa-angle-left right"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="{% url 'vehicles' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Vehicle</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'bins' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Bin</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'routes' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Route</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'route_schedules' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Route Schedule</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'stop_stations' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Stop Station</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'contractors' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Contractor</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'vgms' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Garage Vehicle Mapping</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'wcms' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Ward Contractor Mapping</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'installations' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Installation</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'wards' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Ward</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'ewds' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>EWD</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'divs' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Div</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="{% url 'zones' %}" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Zone</p>
                                    </a>
                                </li>

                                <li class="nav-item">
                                    <a href="#" class="nav-link">
                                        <i class="far fa-circle nav-icon"></i>
                                        <p>Staff Management</p>
                                    </a>
                                </li>

                            </ul>
                        </li>
                        {% endif %}






                    </ul>
                </nav>
            </div>
        </aside>


        
        <div class="content-wrapper">
            <section class="content-header">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-3 col-6">
                            <div class="small-box bg-info">
                                <div class="inner">
                                    <h3 id = "totalvehiclecount"></h3>
                                    <p>Total No. of Vehicles</p>
                                </div>
                                <div class="icon">
                                    <i class="fas "><img src="{% static 'images2/vehicle.png' %}" alt="No of Vehicles" width="80"></i>
                                </div>
                                <a href="javascript:showAllVehicles();" class="small-box-footer">
                              Click Here <i class="fas fa-arrow-circle-right"></i>
                            </a>
                            </div>
                        </div>
                        <!-- ./col -->
                        <div class="col-lg-3 col-6">
                            <div class="small-box bg-success">
                                <div class="inner">
                                    <h3 id = "onlinevehiclecount"></h3>
                                    <p>Online</p>
                                </div>
                                <div class="icon">
                                    <i class="fas "><img src="{% static 'images2/online.png' %}" alt="Online Vehicle" width="80"></i>
                                </div>
                                <a href="javascript:showAllVehicles();" class="small-box-footer">
                                    Click Here <i class="fas fa-arrow-circle-right"></i>
                            </a>
                            </div>
                        </div>
                        <!-- ./col -->
                        <div class="col-lg-3 col-6">
                            <div class="small-box bg-danger">
                                <div class="inner">
                                    <h3>0</h3>
                                    <p>Offline</p>
                                </div>
                                <div class="icon">
                                    <i class="fas "><img src="{% static 'images2/offline.png' %}" alt="Offline Vehicle" width="80"></i>
                                </div>
                                <a href="javascript:showNoVehicles();" class="small-box-footer">
                                    Click Here <i class="fas fa-arrow-circle-right"></i>
                            </a>
                            </div>
                        </div>
                        <!-- ./col -->
                        <div class="col-lg-3 col-6">
                            <div class="small-box bg-warning">
                                <div class="inner">
                                    <h3 id = "vehiclesummarycount"></h3>
                                    <p>All Vehicle Summary</p>
                                </div>
                                <div class="icon">
                                    <i class="fas "><img src="{% static 'images2/report1.png' %}" alt="Reports" width="50"></i>
                                </div>
                                <a href="javascript:showVehicleSummary();" class="small-box-footer">
                              More info <i class="fas fa-arrow-circle-right"></i>
                            </a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>



            
            <section class="content" id = "VehicleSummary" style = "display: none;">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6 vehicle-summary">
                            
                                <!-- <div class="card-header">
                                    <h5 class="card-title">MC</h5>
                                    <div class="card-tools">
                                        {{ mccount }}
                                    </div>
                                </div>
                            </div>

                            <div class="card card-success card-outline">
                                <div class="card-header">
                                    <h5 class="card-title">LC</h5>
                                    <div class="card-tools">
                                        {{ lccount }}
                                    </div>
                                </div>
                            </div>

                            <div class="card card-danger card-outline">
                                <div class="card-header">
                                    <h5 class="card-title">SCV</h5>
                                    <div class="card-tools">
                                        {{ scvcount }}
                                    </div>
                                </div>
                            </div>

                            <div class="card card-warning card-outline">
                                <div class="card-header">
                                    <h5 class="card-title">WW</h5>
                                    <div class="card-tools">
                                        {{ wwcount }}
                                    </div>
                                </div>
                            </div>

                            <div class="card card-info card-outline">
                                <div class="card-header">
                                    <h5 class="card-title">DW</h5>
                                    <div class="card-tools">
                                        {{ dwcount }}
                                    </div>
                                </div>
                            </div>

                            <div class="card card-dark card-outline">
                                <div class="card-header">
                                    <h5 class="card-title">SW</h5>
                                    <div class="card-tools">
                                        {{ swcount }}
                                    </div>
                                </div>
                            </div>

                            <div class="card card-light card-outline">
                                <div class="card-header">
                                    <h5 class="card-title">Other</h5>
                                    <div class="card-tools">
                                        {{ othercount }}
                                    </div>
                                </div>
                            </div> -->



                            <div class="progress-group">
                                MC
                                <span class="float-right"><b>{{ mccount }}</b></span>
                                <div class="progress progress-sm">
                                    <div id = "mccountpercent" class="progress-bar bg-primary" ></div>
                                </div>
                            </div>

                            <div class="progress-group">
                                LC
                                <span class="float-right"><b>{{lccount}}</b></span>
                                <div class="progress progress-sm">
                                    <div id = "lccountpercent" class="progress-bar bg-danger" ></div>
                                </div>
                            </div>


                            <div class="progress-group">
                                SCV
                                <span class="float-right"><b>{{ scvcount }}</b></span>
                                <div class="progress progress-sm">
                                    <div id = "scvcountpercent" class="progress-bar  bg-success" ></div>
                                </div>
                            </div>
                            <div class="progress-group">
                                WW
                                <span class="float-right"><b>{{ wwcount }}</b></span>
                                <div class="progress progress-sm">
                                    <div id = "wwcountpercent" class="progress-bar bg-warning" ></div>
                                </div>
                            </div>
                            <div class="progress-group">
                                DW
                                <span class="float-right"><b>{{ dwcount }}</b></span>
                                <div class="progress progress-sm">
                                    <div id = "dwcountpercent" class="progress-bar bg-secondary" ></div>
                                </div>
                            </div>
                            <div class="progress-group">
                                SW
                                <span class="float-right"><b>{{ swcount }}</b></span>
                                <div class="progress progress-sm">
                                    <div id = "swcountpercent" class="progress-bar bg-info" ></div>
                                </div>
                            </div>

                            <div class="progress-group">
                                Other
                                <span class="float-right"><b>{{ othercount }}</b></span>
                                <div class="progress progress-sm">
                                    <div id = "othercountpercent" class="progress-bar bg-info" ></div>
                                </div>
                            </div>



<br>
<br>







                        


                    </div>
                </div>
            </section>






            <section class="content" id = "NoVehicles" style="display: none;">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="card mb-5">
                                <div class="card-header">
                                    <h3 class="card-title">Dashboard </h3>
                                </div>
                                </div>
                                </div>
                                </div>
                                </div>
                                </section>








            <!-- Main content -->
            <section class="content" id = "AllVehicles">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="card mb-5">
                                <div class="card-header">
                                    <h3 class="card-title">Dashboard </h3>
                                </div>
                                <!-- /.card-header -->
                                <div class="card-body">
                                    <!-- <div class="row mb-3">
                                        <div class="col-md-6">
                                            <button type="button" class="btn btn-danger  btn-sm px-3">
                                                <i class="fa fa-file-word"></i> Excel</button>
                                            <button type="button" class="btn btn-danger  btn-sm px-3 ml-2">
                                                    <i class="fa fa-file-pdf"></i> Word</button>
                                        </div>
                                        <div class="col-md-4 ml-auto">
                                            <div class="row mr-0">
                                                <label class="col-md-3 mb-0 my-auto">Search:</label>
                                                <input type="search" class="form-control form-control-sm col-md-9" placeholder="Search Vehicle" aria-controls="vehicletable">
                                            </div>
                                        </div>
                                    </div> -->
                                    {% if all_entries %}
                                    <table id="vehicletable" class="table table-bordered table-striped tablesorter">
                                        <thead>
                                            <tr>
                                                <th>Sr. No.</th>
                                                <th>Vehicle</th>
                                                <th>Type</th>
                                                <th>Location</th>
                                                <th>Time</th>
                                                <th>Ward</th>
                                                <th>Contractor</th>
                                               <!-- <th>Vehicle Status</th>
                                                <th>Contractor</th> 
                                                <th>Ward</th> -->
                                                <th>Map View</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for each_entry in all_entries reversed %}
                                            <tr>
                                                <td>{{ forloop.counter }}</td>
                                                <td>{{ each_entry.veh  }}</td>
                                                <td style = "text-transform: uppercase;">{{ each_entry.type }}</td>
                                                <td>{{ each_entry.ward  }} </td>
                                                <td>{{ each_entry.time | default_if_none:"" }}</td>
                                                <td>{{ each_entry.veh_ward}}</td>
                                                <td>{{ each_entry.veh_contractor}}</td>
                                                <!--<td>{{ each_entry.trip_status }}</td>-->
                                                <!--<td>{% firstof bin.ward bin.route.ward  %}</td>-->
                                             <!--   <td bgcolor="{{ each_entry.veh_class }}">{{ each_entry.veh_status }}</td>
                                                <td bgcolor="{{ each_entry.speed_class }}">{{ each_entry.speed_status }}</td> 
                                                <td></td> -->
                                                <td class="area"><img src="{% static 'img/location.png' %}"><span style="display:none;">{{  each_entry.lat }},{{each_entry.lon }}</span> </td>
                                            </tr>
                                          {% endfor %}
                                        </tbody>
                                                
                                    </table>
                                    {% else %}
  	<h1>No Data Found</h1>
  {% endif %}
  <div id="loadpositionmap" style="display: none;" align="center">
  </div>
  



                                </div>
                                <!-- /.card-body -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <footer class="main-footer">
            <strong>Copyright &copy; 2022 <a href="https://qdnet.com" target="blank">Qdnet Technologies Pvt. Ltd.</a>.</strong> All rights reserved.
        </footer>


    </div>
    <!-- ./wrapper -->


    <div class="modal fade" id="modal-default">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Map View</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
         <span aria-hidden="true">&times;</span>
        </button>
                </div>
                <div class="modal-body">
                    <p>Map here</p>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <!--<script src="{% static 'js2/jquery.min.js' %}"></script> -->
    <script src="{% static 'js2/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js2/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'js2/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'js2/jquery.overlayScrollbars.min.js' %}"></script>

    <script src="{% static 'js2/adminlte.min.js' %}"></script>

    <script>
        $('#vehicletable').DataTable({
            "paging": true,
            "lengthChange": false,
            "searching": false,
            "ordering": true,
            "info": true,
            "autoWidth": false,
            "responsive": true,
        });


        updatevehiclecount();

        function updatevehiclecount(){


            var a = "{{scvcount}}";
            var b = "{{lccount}}";
            var c = "{{mccount}}";
            var d = "{{wwcount}}";
            var e = "{{dwcount}}";
            var f = "{{swcount}}";
            var g = "{{othercount}}";

            var result = parseInt(a) + parseInt(b) + parseInt(c) + parseInt(d) + parseInt(e) + parseInt(f) + parseInt(g);

            let msg = document.getElementById("vehicletable_info").innerHTML;
            var vcount = msg.slice(19,23);
            document.getElementById("totalvehiclecount").innerHTML = result;
            document.getElementById("onlinevehiclecount").innerHTML = result;
            document.getElementById("vehiclesummarycount").innerHTML = result;


            //Update vehicle summary
            var mccountpercent = (c/result)*100;
            var lccountpercent = (b/result)*100;
            var scvcountpercent = (a/result)*100;
            var wwcountpercent = (d/result)*100;
            var dwcountpercent = (e/result)*100;
            var swcountpercent = (f/result)*100;
            var othercountpercent = (g/result)*100;

            document.getElementById("mccountpercent").style.width = String(mccountpercent)+"%";
            document.getElementById("lccountpercent").style.width = String(lccountpercent)+"%";
            document.getElementById("scvcountpercent").style.width = String(scvcountpercent)+"%";
            document.getElementById("wwcountpercent").style.width = String(wwcountpercent)+"%";
            document.getElementById("dwcountpercent").style.width = String(dwcountpercent)+"%";
            document.getElementById("swcountpercent").style.width = String(swcountpercent)+"%";
            document.getElementById("othercountpercent").style.width = String(othercountpercent)+"%";
        }




    </script>







<!-- Load Esri Leaflet from CDN -->
<script src="https://unpkg.com/esri-leaflet@2.4.1/dist/esri-leaflet.js"
integrity="sha512-xY2smLIHKirD03vHKDJ2u4pqeHA7OQZZ27EjtqmuhDguxiUvdsOuXMwkg16PQrm9cgTmXtoxA6kwr8KBy3cdcw=="
crossorigin=""></script>


<!-- Load Esri Leaflet Geocoder from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.3.3/dist/esri-leaflet-geocoder.css"
  integrity="sha512-IM3Hs+feyi40yZhDH6kV8vQMg4Fh20s9OzInIIAc4nx7aMYMfo+IenRUekoYsHZqGkREUgx0VvlEsgm7nCDW9g=="
  crossorigin="">
  <script src="https://unpkg.com/esri-leaflet-geocoder@2.3.3/dist/esri-leaflet-geocoder.js"
  integrity="sha512-HrFUyCEtIpxZloTgEKKMq4RFYhxjJkCiF5sDxuAokklOeZ68U2NPfh4MFtyIVWlsKtVbK5GD2/JzFyAfvT5ejA=="
  crossorigin=""></script>

  <script>
      let mymap = L.map('loadpositionmap').setView([19.122777, 72.894568],19);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      subdomain :['a','b','c']	
      }).addTo(mymap);

      var bin_icon = L.icon({
          iconUrl: '{% static "img/Bin.jpeg" %}',
          iconSize: [24, 34],
      });
      var geocodeService = L.esri.Geocoding.geocodeService();

      var marker;
      $(document).ready(function(){
              setTimeout(function () {
              location.reload(true);
              },60000); 

          $('table').tablesorter({theme:'metro-dark'});
          $("td.area").click(function () {
                      if( marker ){
                                mymap.removeLayer(marker);
              }

              var [lat,lon] = $(this).children().text().split(',');
              var latlng = L.latLng(lat,lon);
                              mymap.panTo(latlng);
                  geocodeService.reverse().latlng(latlng).run(function (error, result) {
                        if (error) {
                          return;
                  }
                  marker = L.marker(result.latlng).addTo(mymap).bindPopup(result.address.Match_addr).openPopup();
              });

              $("#loadpositionmap").dialog({
                  modal: true,
                  autoOpen: false,
                  title: " Bin ",
                  width: 600,
                  height: 600
              });
              $("#loadpositionmap").dialog('open');
              mymap.invalidateSize();
              return false;
          });

          $("a.delete_bin").click(function () {
              var bin_id = $(this).attr('id');
              var $tr = $(this).closest('tr');

              $.ajax({
                  type:'POST',
                  url:'{% url "delete_bin" %}',
                  data: {
                      'id':bin_id 
                  },
                  beforeSend: function(xhr) {
                      xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}" );
                  },
                  success:function(res){
                      $tr.find('td').fadeOut(1000,function(){
                          $tr.remove();
                      })	
                  },
                  error:function(a,b,c){
                      alert(b);
                      alert(c);
                  }
              });
          });
      });
  </script>




<script>



    function showAllVehicles(){
        document.getElementById("AllVehicles").style.display = "block";
        document.getElementById("NoVehicles").style.display = "none";
        document.getElementById("VehicleSummary").style.display = "none";

    }

    function showNoVehicles(){
        document.getElementById("AllVehicles").style.display = "none";
        document.getElementById("NoVehicles").style.display = "block";
        document.getElementById("VehicleSummary").style.display = "none";

    }

    function showVehicleSummary(){
        document.getElementById("AllVehicles").style.display = "none";
        document.getElementById("NoVehicles").style.display = "none";
        document.getElementById("VehicleSummary").style.display = "block";

    }







</script>






</body>

</html>