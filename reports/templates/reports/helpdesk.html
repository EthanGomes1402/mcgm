{% extends 'base.html' %}
{% load static %}

{% block title %}
	<h1>Helpdesk</h1>
{% endblock %}





{% block content_title %}Helpdesk{% endblock %}
{% block content %}



  <div>
	  <a class="btn btn-warning  px-3" href="{% url 'helpdesk_add' %}" ><b>Add Compliant</b></a>
    

	
        
     

    </div>
  
  {% if helpdesk %}
 

  <button class="btn btn-danger  btn-sm px-3 ml-2" id="export_to_excel" style="float: right;">Export To Excel</button>
  <button class="btn btn-danger  btn-sm px-3 ml-2" id="export_to_pdf" style="float: right;">Export To PDF</button>

  <br><br>
  <table class="table table-bordered table-striped tablesorter" id="helpdesk">
    <thead style="text-align:center">
      <tr>
        <th>Sr No</th>
        <th>Email</th>
        <th>Phone Number</th>
        <th>Query</th>
        <th>Ward</th>
        <th>Response</th>
        <th>Date</th>
        {% if user.is_authenticated and user.is_superuser %}
        <th>Action</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for query in helpdesk %}
        <tr>
          <td>  {{ forloop.counter }} </td>
          <td>{{ query.email }} </td>
          <td>{{ query.phone_number}}</td>
	        <td>{{ query.query}}</td>
          <td>{{ query.ward}}</td>
          <td>{{ query.action}}</td>
          <td>{{ query.created_at|date:"Y-m-d H:i:s" }}</td>

      


          {% if user.is_authenticated and user.is_superuser %}   
          <td>
            <div class="btn-group btn-group-sm">
                <a href="{% url 'query_response' query.pk %}" class="btn btn"><i class="fas fa-pen"></i></a>
              <!--  <a id="{{query.pk}}" href="#" class="btn btn-danger delete_allocation"><i class="fas fa-trash"></i></a>  -->
                </div>
		    </td>
        {% endif %}
        <!--
          <td>{{ vehicle.maker }} </td>
          <td style="text-transform: uppercase;">{{ vehicle.vehicle_type }}</td>
          <td>{{ vehicle.contractor }}</td>
          <td> -->
		   
		    


      
       
    
        

	      </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
	<h1>No Queries</h1>
  {% endif %}











{% endblock %}

{% block js %}
<script>
	$(document).ready(function(){
	    $('table').tablesorter({theme:'metro-dark'});
        $("a.delete_vehicle").click(function () {
            var veh_id = $(this).attr('id');
            var $tr = $(this).closest('tr');

            $.ajax({
                type:'POST',
                url:'{% url "delete_vehicle" %}',
                data: {
                    'id':veh_id 
                },
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}" );
                },
                success:function(res){
                    $tr.find('td').fadeOut(1000,function(){
                        $tr.remove();
                    })	
                },
                error:function(a,b,c){
                    alert(b);
                    alert(c);
                }
            });
        });

		$("button#export_to_excel").click(function() {
			var dNow = new Date();
			var file_time_str = dNow.getMonth() + '_' + dNow.getDate() + '_' + dNow.getFullYear() + '_' + dNow.getHours() + '_' + dNow.getMinutes() + '_' + dNow.getSeconds();
			$("#helpdesk").table2excel({
				name: "helpdesk",
				filename: "helpdesk_" + file_time_str + ".xlsx"//do not include extension
			});
		});
	   
		

		$("button#export_to_pdf").click(function() {
			$("#helpdesk").tableHTMLExport({type:'pdf',filename:'helpdesk.pdf'});
		});
	});
</script>
{% endblock %}
