
{% block extrastylesheet %}


<style>
html,

body{
    margin: 0px;
    height: 100%;
} 

div.leaflet-top.leaflet-right{ display: none !important; width: 0px  !important; height: 0px  !important; }

</style>






{% endblock %}


{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map View</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
   integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
   crossorigin=""/>
   
  


 </head>
<body>

	  <div class="box" id="map" style="width:100%;height:100%; box-sizing: border-box;" class="col-md-9" >
	  </div>

<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
   integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
   crossorigin=""></script>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>


<link rel="stylesheet" href="{% static 'js/leaflet_routing_machine.js' %}">
      <script src="{% static 'js/leaflet_routing_machine.js' %}"></script>


<script>
             var map = L.map('map').setView([19.1, 72.8], 11);
             L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap'
}).addTo(map); 

var vehicle = [
["Data1",19.122777, 72.894568,180],
["Data2",19.122554, 72.894096,66],
];

var bin_arr_lat1 = [] ;
var bin_arr_lon1 = [] ;

console.log("BIN LAT1 IS: "+bin_arr_lat1);
console.log("BIN LON1 IS: "+bin_arr_lon1);


//var bin_arr = [];

var bin_arr_lat = [] ;
var bin_arr_lon = [] ;

"{% for res1 in bin_data %}"
var bin_code = "{{res1.bin_code}}"
var bin_lat = "{{res1.bin_lat}}"
var bin_lon = "{{res1.bin_lon}}"
var route_code = "{{res1.route_code}}"
var bin_compliance = "{{res1.bin_compliance}}"
var bin_name = "{{res1.bin_name}}"
var is_ML_CP = "{{res1.is_ML_CP}}"
var bin_time = "{{res1.bin_time}}"
//bin_arr_data = bin_lat + "," + bin_lon 
//bin_arr.push(bin_arr_data)

bin_arr_lat.push(bin_lat);
bin_arr_lon.push(bin_lon);

console.log("Total number of bins are: "+ bin_code);
console.log("Bin Time is: "+ bin_time);

/*
console.log(bin_code)
console.log(bin_lat)
console.log(bin_lon)
console.log(route_code)
*/
//console.log(bin_compliance)

if(bin_compliance == 'Y'){
    console.log("BIN COMPLIED: YES")
}
else if(bin_compliance == 'N'){
    console.log("BIN COMPLIED: NO")
}



//var pop_data_bin = 'Route Code: '+ route_code + ' <br> Bin No: '+ bin_code + ' <br> Bin Name: '+ bin_name +  '<br> Bin Location: '+bin_lat+','+bin_lon;



    //var num_heading = heading;
   
    if(is_ML_CP == 'ML'){
        var binIcon = L.icon({
            iconUrl: '{% static 'img/mlc.png' %}',
            
            iconSize: [40, 40],
            });
            var pop_data_bin = 'Route Code: '+ route_code +  ' <br> Name: '+ bin_name +  '<br> Location: '+bin_lat+','+bin_lon + '<br> Time: '+ bin_time;
    }
    else if(is_ML_CP == 'CP'){
        var binIcon = L.icon({
            iconUrl: '{% static 'img/mlc.png' %}',
            
            iconSize: [40, 40],
            });
            var pop_data_bin = 'Route Code: '+ route_code +  ' <br> Name: '+ bin_name +  '<br> Location: '+bin_lat+','+bin_lon + '<br>  Time: '+ bin_time;
    }


    else if(is_ML_CP == 'Bin'){
    if(bin_compliance == 'Y'){
        var binIcon = L.icon({
            iconUrl: '{% static 'img/green_bin2.png' %}',
            
            iconSize: [40, 40],
            });
            var pop_data_bin = 'Route Code: '+ route_code + ' <br> Bin No: '+ bin_code + ' <br> Bin Name: '+ bin_name +  '<br> Bin Location: '+bin_lat+','+bin_lon + '<br> Pickup Time: '+ bin_time;    
    }
    else if(bin_compliance == 'N'){
        var binIcon = L.icon({
            iconUrl: '{% static 'img/bin2.png' %}',
            iconSize: [40, 40],
            });
            var pop_data_bin = 'Route Code: '+ route_code + ' <br> Bin No: '+ bin_code + ' <br> Bin Name: '+ bin_name +  '<br> Bin Location: '+bin_lat+','+bin_lon;
    }
    }
    

    //console.log(lat+" "+lon)
    var marker = L.marker([bin_lat,bin_lon], {icon: binIcon}).bindPopup(pop_data_bin).addTo(map);
   // var marker = L.marker([vehicle[i][1],vehicle[i][2]], {icon: arrowIcon}).bindPopup(vehicle[i][0]).addTo(map);

"{% endfor %}"

console.log("BIN LAT IS: "+bin_arr_lat);
console.log("BIN LON IS: "+bin_arr_lon);


/*
var vehicle = [
["Bin1",19.120539,72.937294],
["Bin2",19.125189,72.952171],
];

//iconUrl: '{% static 'img/arrow_180.png' %}',
for (var i = 0; i < vehicle.length; i++) {
    var num = '180';
    //var loc = "'"+'arrow_img/arrow_270.png'+ "'";


   
    var arrowIcon = L.icon({
        iconUrl: '{% static 'img/Bin.jpeg' %}' ,
        iconSize: [25, 25],
        });

//console.log(vehicle[i][1])
//console.log(vehicle[i][2])
var marker = L.marker([vehicle[i][1],vehicle[i][2]], {icon: arrowIcon}).bindPopup(vehicle[i][0]).addTo(map);
}
     
*/
var myIcon = L.icon({
    iconUrl: '{% static 'img/new_bin.png' %}',
    iconSize: [1, 1],
    iconAnchor: [1, 1],
    popupAnchor: [0, -10]
});           

var control = L.Routing.control({
    createMarker: function(i, waypoint, n) {
            return L.marker(waypoint.latLng, {
                routeWhileDragging: false,
                icon: myIcon
            });
        },
        waypoints: [
          
        ],
       
        
        lineOptions: {
            styles: [{
                color: 	'#0096FF',
                opacity: 5,
                weight: 8,
                interactive: false,
                draggable: false
            }]
            
        }
    
    }).addTo(map); 

    var waypointsArray = []
    
   // length_val =  10;
    for (var i = 0; i < bin_arr_lat.length; i++) {
      control_val = L.latLng(bin_arr_lat[i],bin_arr_lon[i]);
      waypointsArray.push(control_val);
    }

    control.setWaypoints(waypointsArray);




"{% for res in response_data %}"

//var all_data = "{{res}}"
var lon = "{{res.lon}}"
var lat = "{{res.lat}}"
var heading = "{{res.heading}}"
var speed = "{{res.speed}}"
var time = "{{res.time}}"
var shift = "{{res.shift}}"
var v_id = "{{res.v_id}}"

//console.log(v_id)
bin_arr_lat1.push(lat);
bin_arr_lon1.push(lon);

//console.log(all_data[1])


//for (var i = 0; i < vehicle.length; i++) {
    //var num = '180';
    //var loc = "'"+'arrow_img/arrow_270.png'+ "'";

    var pop_data = 'Speed: '+ speed + 'km/hr '+ ' <br> Date: '+ time + '<br> Shift: '+ shift + '<br> Position: '+lat+','+lon;
    var num_heading = heading;
    var round_heading = Math.round(num_heading/22)*22;

    if(round_heading == 0){
        var arrowIcon = L.icon({
        iconUrl: '{% static 'img/arrow_img/arrow_0.png' %}',
        iconSize: [20, 20],
        });
        //console.log(lat+" "+lon)
        var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
       // var marker = L.marker([vehicle[i][1],vehicle[i][2]], {icon: arrowIcon}).bindPopup(vehicle[i][0]).addTo(map);
    }

    else if(round_heading == 22){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_22.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 44){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_44.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 66){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_66.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 88){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_90.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 110){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_110.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 132){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_132.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 154){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_154.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 176){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_180.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 198){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_198.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 220){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_220.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 242){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_242.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 264){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_270.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 286){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_286.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 308){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_308.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 330){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_330.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }

     else if(round_heading == 352){
        var arrowIcon = L.icon({
            iconUrl: '{% static 'img/arrow_img/arrow_360.png' %}',
            iconSize: [20, 20],
            });
            //console.log(lat+" "+lon)
            var marker = L.marker([lat,lon], {icon: arrowIcon}).bindPopup(pop_data).addTo(map);
     }







"{% endfor %}"




  </script>
</body>
</html>


  


   
      



</body>
</html>